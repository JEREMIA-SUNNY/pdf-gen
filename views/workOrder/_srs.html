{% macro detail_item(label, value) %}
<p style="margin-bottom: 12px;">
    <strong style="font-size: 14px;">{{ label }}</strong><br>
    {% if value %}
        {% if '\n' in value %}
            <span style="white-space: pre-line;">{{ value }}</span>
        {% else %}
            <span>{{ value }}</span>
        {% endif %}
    {% else %}
        <span>N/A</span>
    {% endif %}
</p>
{% endmacro %}

{% if srs and srs|length > 0 %}
<div class="section page-break">
  <div class="section-title">Strain Relief Sleeve & Marker Details</div>

  {# Group SRS data by main SRS marker to avoid duplication #}
  {% set srs_groups = {} %}
  {% for item in srs %}
    {% if item.id not in srs_groups %}
      {% set _ = srs_groups.update({item.id: {'main': item, 'nkrf_details': []}}) %}
    {% endif %}
    {% if item.nkrfPartNumber %}  {# Only add if it has NKRf details #}
      {% set _ = srs_groups[item.id]['nkrf_details'].append(item) %}
    {% endif %}
  {% endfor %}

  {% for group_id, group_data in srs_groups.items() %}
    {# Display main SRS details only once per group #}
    {% set main_srs = group_data.main %}
    {{ detail_item("Strain Relief Sleeve Type", main_srs.strainReliefSleeveType) }}
    {{ detail_item("Marker Sleeve Type", main_srs.markerSleeveType) }}

    {# Display NKRf details in table if they exist #}
    {% if group_data.nkrf_details|length > 0 %}
    <table class="data-table">
      <thead>
        <tr>
          <th>NKRF Part No</th>
          <th>Assembly Length</th>
          <th>SRS Sleeves</th>
          <th>SRS Length</th>
          <th>No. of Markers</th>
          <th>Marker Length</th>
          <th>Font</th>
        </tr>
      </thead>
      <tbody>
        {% for nkrf_item in group_data.nkrf_details %}
        <tr>
          <td>{{ nkrf_item.nkrfPartNumber or 'N/A' }}</td>
          <td>{{ nkrf_item.assemblyLength or 'N/A' }}</td>
          <td>{{ nkrf_item.noOfSrsSleeves or 'N/A' }}</td>
          <td>{{ nkrf_item.srsLength or 'N/A' }}</td>
          <td>{{ nkrf_item.noOfMarkers or 'N/A' }}</td>
          <td>{{ nkrf_item.markerLength or 'N/A' }}</td>
          <td>{{ nkrf_item.font or 'N/A' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p style="margin: 15px 0; color: #666;">No NKRf details available</p>
    {% endif %}

    {# Additional details #}
    {% if main_srs.additionalMarkerSleeveDetails %}
      {{ detail_item("Additional Marker Details", main_srs.additionalMarkerSleeveDetails) }}
    {% endif %}

{% if customerMarkerDetailsDrawingUrl %}
<!-- Dedicated page for image -->
<div class="section" style="page-break-before: always;">
  <div class="subsection-title">Customer Marker Details Drawing</div>
  
  <div style="text-align: center; margin-top: 20px;">
    <img src="{{ customerMarkerDetailsDrawingUrl }}"
         alt="Customer Marker Details Drawing"
         style="max-width: 90%; max-height: 580px; height: auto; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" />
   
  </div>
</div>
{% endif %}

    {% if not loop.last %}
    <div style="margin: 20px 0; border-bottom: 1px dashed #ccc;"></div>
    {% endif %}
  {% endfor %}
</div>
{% endif %}